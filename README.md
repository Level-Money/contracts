## Level Protcol Contracts

The Level Protocol is structured around the ERC-20 `lvlUSD` stablecoin. `LevelMinting` allows users to mint `lvlUSD` by collateralizing stablecoins like USDC and USDT and to redeem collateral by burning `lvlUSD`. The Level Reserve Manager uses collateral to generate yield and rewards by staking in restaking protocols like Symbiotic and Karak.

## lvlUSD

`lvlUSD` is an ERC20 stablecoin token that supports denylisting, minting, and burning. Denylisted addresses are not allowed to transfer or receive `lvlUSD`.
The admin can designate up to one _minter_. This designation can be revoked and changed at any time. The minter is allowed to mint `lvlUSD` to a non-denylisted receiver address.

### Roles

| Role             | Description                                                                                                                                                                                                                    | Operators                                                            | # of Roles | Type     |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------- | ---------- | -------- |
| Admin            | The admin of the contract can set the minter contract, the slasher contract, and denylister EOAs                                                                                                                               | Level Foundation                                                     | 1          | Multisig |
| Denylist Manager | The denylist manager can add arbitrary EOAs to a denylist, which prevents the address from transferring, minting, or redeeming lvlUSD. This is similar to Tether and Circle’s denylist, and intended to be used a similar way. | Level Foundation                                                     | N < 5      | Multisig |
| Minting Contract | See LevelMinting                                                                                                                                                                                                               | Smart contract whose admin address is controlled by Level Foundation | 1          | Contract |

### Functions

| Functionality                         | Description                                                                                               | Access Control   | # of Roles | Type     |
| ------------------------------------- | --------------------------------------------------------------------------------------------------------- | ---------------- | ---------- | -------- |
| mint()                                | Adds to lvlUSD supply. Can only be called by a single address (the minting contract).                     | Minting Contract | 1          | Multisig |
| burn()                                | Decrement’s the caller’s balance to remove lvlUSD from the total supply.                                  | Anyone           | N < 5      | Multisig |
| transfer() / transferFrom()           | Transfers lvlUSD from one address to another. This transaction will fail for denylisted addresses         | Anyone           | 1          | Contract |
| setMinter()                           | Lets the admin designate the single LevelMinting contract that all mints and redemptions will go through. | Admin            |            |          |
| addToDenylist()/ removeFromDenylist() | Lets the admin denylist an address, preventing it from minting, burning, or transferring any lvlUSD.      | Denylist Manager |            |          |

## LevelMinting

`LevelMinting` is inspired by and built on top of Ethena protocol's `EthenaMinting` [contract](https://github.com/ethena-labs/code4arena-contest/blob/main/protocols/USDe/contracts/EthenaMinting.sol). It controls the supply of `lvlUSD` in circulation by allowing approved minters and redeemers to mint `lvlUSD` by depositing collateral assets (e.g. USDC, USDT) and redeem assets by burning `lvlUSD` in a 1:1 ratio. Redemptions are done in a two-step process when cooldowns are enabled -- by default users have to wait 7 days to redeem their collateral.

### Roles

| Role       | Description                                                                                                                                                                                 | Operators                                           | # of Roles | Type     |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- | ---------- | -------- |
| Admin      | The admin of the contract can: set minters, redeemers, and gatekeepers, add/remove authorized collateral, and add/remove authorized reserve addresses.                                      | Level Foundation                                    | 1          | Multisig |
| Minter     | Minters are authorized addresses that can call mint() on the LevelMinting contract.                                                                                                         | Level Foundation                                    | N < 20     | EOA      |
| Redeemer   | Redeemers are authorized addresses that can call redeem() on the LevelMinting contract                                                                                                      | Level Foundation                                    | N < 20     | EOA      |
| Gatekeeper | Gatekeepers guard the protocol from unauthorized mints and redemptions. Gatekeeper addresses can stop all issuance, as well as remove the minter and redeemer role from specific addresses. | Level Foundation and 3rd party security contractors | N          | EOA      |

## Functions

| Functionality                                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Access Control |
| --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| mint()                                        | This function atomically swaps a supported stablecoin from a benefactor address to lvlUSD that’s sent to a beneficiary address. The conversion rate is assumed to be one-to-one. This function can only be called by an address with the minter permission. The contract can also define a max. mint amount per unit of time. Mints that exceed that amount will fail.                                                                                                                                                                                                                                                                                                              | Minter         |
| redeem()                                      | This function can only be called when cooldown for redemptions is turned off. It atomically and immediately swaps lvlUSD from a benefactor address to a supportedAsset that’s sent to a beneficiary address. The conversion rate is assumed to be one-to-one. The lvlUSD that is sent to be redeemed is burned. This function can only be called by an address with the redeemer permission. The contract can also define a max. redeem amount per unit of time. Redemptions that exceed that amount will fail. To support redemptions, the LevelMinting contract will need to hold collateral assets, namely other stablecoins. These reserves are managed by LevelReserveManager. | Redeemer       |
| initiateRedeem()                              | This function can only be called when cooldowns for redemptions are enabled (`cooldownDuration` > 0). It initiates the redemption process by storing the user's order request in contract storage and by starting a timer, after which the request may be fulfilled via `completeRedeem`. Other aspects of this function are the same as `redeem`. By default, the cooldown period is set to be 7 days. This gives LevelReserveManager time to unstake collateral and transfer them back to LevelMinting so that redemptions from users can be fulfilled.                                                                                                                           | Redeemer       |
| completeRedeem()                              | This function can only be called when cooldowns for redemptions are enabled (`cooldownDuration` > 0). This functions calls the internal `_redeem` function to fulfill a user's redemption request, and should be called after the user waits for `cooldownDuration` after calling `initiateRedeem`.                                                                                                                                                                                                                                                                                                                                                                                 | Redeemer       |
| transferToReserve()                           | Transfers supportedAssets to the LevelReserveManager. This function can only be called by an address with the admin permission.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Minter         |
| setMaxMintPerBlock() / setMaxRedeemPerBlock() | Defines the max amount of lvlUSD that can be minted or redeemed per block. Can be thought of as a rate limiter that minimizes the impact of malicious addresses.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Admin          |
| disableMintRedeem()                           | Sets the max amount of lvlUSD that can be minted or redeemed to 0, disabling mints and redemptions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Gatekeeper     |
| addSupportedAsset() / removeSupportedAsset()  | Adds assets that can be used to mint or redeem lvlUSD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Admin          |
| addReserveAddress() / removeReserveAddress()  | Adds valid reserve addresses that collateral can be transferred to/from                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Admin          |
| removeMinterRole() / removeRedeemerRole()     | Removes the minter/redeemer role from addresses, intended to secure the protocol against compromised keys/addresses.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Gatekeepers    |


## LevelReserveManager

`LevelReserveManager` is a reserve for user collateral and allows a multisig admin to manage user funds and use them to generate yield. Specifically, it allows the admin to deposit tokens into restaking protocols like Karak and Symbiotic to earn points, as well as restaking rewards. In the future, LevelReserveManager will support depositing collateral into Aave.

### Roles

| Role       | Description                                                                                                                                                                                 | Operators                                           | # of Roles | Type     |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- | ---------- | -------- |
| Admin      | The admin of the contract can: transfer reserve funds to allowlisted addresses, deposit and withdraw from Karak and Symbiotic, and deposit to LevelMinting.                           | Level Foundation                                    | 1          | Multisig |
| Allowlist Manager     | This role is able to add addresses where reserve funds can be transferred to. For example, this role might allowlist a new LRM, so that funds can be transferred over.                                                                                                        | 3rd Party                                    | 1     | Multisig      |

## Functions

| Functionality                                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Access Control |
| --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| transferERC20 / transferEth                                        | These functions allow the admin to transfer funds from the reserve manager to an allowlisted address.                                                                                                                                                                                                                                                                                                              | Admin         |
| addToAllowList / removeFromAllowList                              | These functions allow the allowlist manager to add or remove addresses from the allowlist.                                                                                                                         | Allowlist Manager       |
| depositToSymbiotic / withdrawFromSymbiotic / claimFromSymbiotic                              | These functions allow the admin to deposit tokens into a Symbiotic vault and then claim the tokens after initiating the withdraw process and waiting for an epoch to pass.                                                                                                                                                                                                                                                                                                                                                               | Admin       |
| depositToKarak / startRedeemFromKarak / finishRedeemFromKarak                           | These functions allow the admin to deposit tokens into a Karak vault and then claim the tokens after initiating the withdraw process (obtaining a withdrawal key in the process) and waiting for an cooldown period to end.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Admin         |
| approveSpender | Approves an external contract to spend funds stored in the reserve manager. It is necessary to approve vaults before depositing into them.                             | Admin                                                                                                                                                                                                                                                                                                                                                                                                                                                              
